<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-3d@latest/dist/chartjs-plugin-3d.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
            --background-color: linear-gradient(135deg, #ffffff, #ffffff);
            --text-color: #333;
            --header-background: rgba(255, 255, 255, 0.9);
            --header-text-color: #333;
            --sidebar-background: linear-gradient(135deg, #4e4376, #6a5acd);
            --sidebar-text-color: #fff;
            --card-background: rgba(255, 255, 255, 0.9);
            --card-text-color: #333;
            --button-background: #381e97;
            --button-hover-background: #6a5acd;
            --button-text-color: white;
            --chart-background: rgba(255, 255, 255, 0.9);
            --chart-border-color: rgba(0, 0, 0, 0.1);
            --chart-grid-color: rgba(0, 0, 0, 0.05);
            --week-card-background: #9a9a9a; /* Cinza menos escuro */
            --week-card-text-color: #ffffff; /* Branco para contraste */
        }
    
        body.dark-mode {
            --background-color: linear-gradient(135deg, #0a0f1e, #0d1b2a);
            --text-color: #e0e0e0;
            --header-background: rgba(27, 38, 59, 0.8);
            --header-text-color: #e0e0e0;
            --sidebar-background: linear-gradient(135deg, #1b263b, #0d1b2a);
            --sidebar-text-color: #e0e0e0;
            --card-background: rgba(27, 38, 59, 0.8);
            --card-text-color: #e0e0e0;
            --button-background: #4e4376;
            --button-hover-background: #3a2d5e;
            --button-text-color: white;
            --chart-background: rgba(27, 38, 59, 0.8);
            --chart-border-color: rgba(255, 255, 255, 0.1);
            --chart-grid-color: rgba(255, 255, 255, 0.05);
            --week-card-background: #5a5a5a; /* Cinza menos escuro para dark mode */
            --week-card-text-color: #e0e0e0; /* Branco para contraste */
        }
    
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
    
        .theme-toggle-button {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #6a5acd;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            z-index: 1001; /* Ensure the button is above other elements */
        }
    
        .theme-toggle-button:hover {
            background-color: #4e4376;
            transform: scale(1.1);
        }
    
        .sidebar {
            width: 60px;
            background: var(--sidebar-background);
            color: var(--sidebar-text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            box-sizing: border-box;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            transition: width 0.3s ease, background 0.3s;
            z-index: 1000;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
    
        .sidebar:hover {
            width: 220px;
        }
    
        .sidebar a {
            color: var(--sidebar-text-color);
            text-decoration: none;
            margin: 10px 0;
            width: 100%;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.3s, width 0.3s;
            white-space: nowrap;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    
        .sidebar a i {
            margin-right: 10px;
            font-size: 1.2em;
        }
    
        .sidebar a span {
            display: none;
            transition: display 0.3s;
        }
    
        .sidebar:hover a span {
            display: inline;
        }
    
        .main-content {
            flex-grow: 1;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            background: var(--background-color);
            color: var(--text-color);
            margin-left: 60px;
            transition: margin-left 0.3s ease, background 0.3s;
        }
    
        .sidebar:hover ~ .main-content {
            margin-left: 200px;
        }
        .header {
            background: var(--header-background);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: calc(100% - 80px); /* Espaçamento da aba lateral */
            transition: background-color 0.3s, color 0.3s;
            margin-bottom: 20px; /* Espaçamento entre o cabeçalho e o funil */
            height: 80px;
        }
    
        
    
        .header h1 {
    font-family: 'Merriweather', serif; /* Mantém a fonte Merriweather */
    font-size: 3em; /* Ajuste o tamanho conforme necessário */
    font-weight: 700; /* Negrito */
    color: var(--header-text-color); /* Mantém a cor existente */
    text-align: center; /* Centraliza o texto */
    letter-spacing: 1px; /* Adiciona espaçamento entre as letras */
    position: relative; /* Necessário para posicionar as linhas */
    display: inline-block; /* Garante que o texto seja tratado como bloco */
}

.header h1::before,
.header h1::after {
    content: ''; /* Adiciona conteúdo vazio para as linhas */
    position: absolute;
    top: 50%; /* Centraliza verticalmente em relação ao texto */
    width: 50px; /* Comprimento da linha, ajuste conforme necessário */
    height: 2px; /* Espessura da linha */
    background-color: var(--header-text-color); /* Cor da linha */
}

.header h1::before {
    left: -60px; /* Posiciona a linha à esquerda */
}

.header h1::after {
    right: -60px; /* Posiciona a linha à direita */
}
.sidebar:hover ~ .header {
            width: calc(100% - 220px);
        }
    
        .user-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
    
        .user-info i {
            font-size: 2em;
            color: #6a5acd;
        }
    
        .user-info span {
            margin-top: 5px;
            font-size: 1em;
            color: var(--header-text-color);
        }
    
            .info-cards {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    justify-content: center;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
}
#toggleButtonRelatorio {
    margin-left: 0;
}
    
        .info-card {
            background: var(--card-background);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            max-width: 300px;
            transition: transform 0.3s ease, background-color 0.3s, color 0.3s;
        }
    
        .info-card:hover {
            transform: translateY(-10px);
        }
    
        .info-card h2 {
            margin: 0;
            font-size: 1.5em;
            color: var(--card-text-color);
        }
    
        .info-card p {
            margin: 5px 0 0 0;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--card-text-color);
        }
    
        .chart-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 20px; /* Espaçamento entre as linhas de gráficos */
        }

        .chart-container {
            width: 30%;
            margin-top: 10px;
            margin-bottom: 10px; /* Espaçamento entre os gráficos */
            padding: 10px; /* Espaçamento interno para os gráficos */
            background: white; /* Fundo branco para os gráficos */
            border-radius: 10px; /* Bordas arredondadas */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Sombra para os gráficos */
        }
    
        .chart-container h2 {
            margin: 0;
            font-size: 1.5em;
            color: #000000;
            text-align: center;
        }
    
        .chart-container canvas {
            margin-top: 20px;
        }
    
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
    
        .nav-buttons button {
            background-color: var(--button-background);
            color: var(--button-text-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
    
        .nav-buttons button:hover {
            background-color: var(--button-hover-background);
            transform: scale(1.1);
        }
    
        .content-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
            width: 100%; /* Ajuste a largura total */
        }
    
        .content {
            display: none;
            text-align: center;
            width: 100%; /* Ajuste a largura total */
        }
    
        .content.active {
            display: block;
        }
    
        .week-selector {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
    
        .tasks-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background-color: linear-gradient(135deg, #4e4376, #6a5acd); /* Fundo preto */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Estilo para a agenda */
        #agenda {
            background: linear-gradient(135deg, #4e4376, #6a5acd); /* Gradiente especificado */
            padding: 20px; /* Ajuste o padding conforme necessário */
            border-radius: 10px; /* Ajuste o border-radius conforme necessário */
            color: white; /* Ajuste a cor do texto conforme necessário */
            padding-left: 80px; /* Espaçamento da aba lateral */
            padding-right: 80px; /* Espaçamento da borda da página */
            margin-top: 20px; /* Espaçamento da borda superior */
            margin-bottom: 20px; /* Espaçamento da borda inferior */
            box-sizing: border-box; /* Inclui padding na largura total */
            width: calc(100% - 160px); /* Ajusta a largura para caber na tela */
        }
        #dateFilterGroup {
    margin-bottom: 20px;
}
#tarefasContainer {
    width: 113%; /* Ajuste a largura conforme necessário */
    min-height: 500px; /* Aumente a altura mínima */
    padding: 20px; /* Adicione espaçamento interno */
    box-sizing: border-box; /* Inclui padding e borda no tamanho total */
    margin-left: -6.5%;
}
        /* Estilo para as colunas do dia */
        .day-column {
            background: rgba(255, 255, 255, 0.1); /* Fundo semi-transparente para contraste */
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            color: white; /* Ajuste a cor do texto conforme necessário */
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        
        }
        
        #relatorioComercial {
            background: linear-gradient(135deg, #4e4376, #6a5acd); /* Gradiente especificado */
            padding: 20px; /* Ajuste o padding conforme necessário */
            border-radius: 10px; /* Ajuste o border-radius conforme necessário */
            color: white; /* Ajuste a cor do texto conforme necessário */
            padding-left: 80px; /* Espaçamento da aba lateral */
            padding-right: 80px; /* Espaçamento da borda da página */
            margin-top: 20px; /* Espaçamento da borda superior */
            margin-bottom: 20px; /* Espaçamento da borda inferior */
            box-sizing: border-box; /* Inclui padding na largura total */
            width: calc(100% - 160px); /* Ajusta a largura para caber na tela */
        }

        #relatorioProdutividade {
            background: linear-gradient(135deg, #4e4376, #6a5acd); /* Gradiente especificado */
            padding: 20px; /* Ajuste o padding conforme necessário */
            border-radius: 10px; /* Ajuste o border-radius conforme necessário */
            color: white; /* Ajuste a cor do texto conforme necessário */
            padding-left: 80px; /* Espaçamento da aba lateral */
            padding-right: 80px; /* Espaçamento da borda da página */
            margin-top: 20px; /* Espaçamento da borda superior */
            margin-bottom: 20px; /* Espaçamento da borda inferior */
            box-sizing: border-box; /* Inclui padding na largura total */
            width: calc(100% - 160px); /* Ajusta a largura para caber na tela */
        }
        
        /* Estilo para os cards de tarefas */
        .card {
            background: linear-gradient(135deg, #f0f0f0, #d0d0d0); /* Gradiente diferente para as tarefas */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Estilo para o seletor de semana */
        .week-selector {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 40px; /* Espaçamento maior dos cards acima */
        }
        
        /* Estilo para o campo de filtro */
        .week-selector label {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .week-selector input[type="week"] {
            padding: 10px;
            border: 2px solid #6a5acd;
            border-radius: 5px;
            font-size: 1em;
            background-color: white;
            color: #333;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .week-selector input[type="week"]:focus {
            border-color: #4e4376;
            box-shadow: 0 0 10px rgba(78, 67, 118, 0.5);
        }
        .day-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 20px;
            background-color: var(--week-card-background); /* Fundo cinza menos escuro */
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, color 0.3s;
        }
    
        .day-column h4 {
            margin: 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            color: var(--week-card-text-color); /* Cor da fonte ajustada */
        }
    
        .card {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: background-color 0.3s, color 0.3s;
        }
    
        .card-header {
            font-weight: bold;
            font-size: 1.2em;
            color: #4e4376;
        }
    
        .card-body p {
            margin: 5px 0;
            font-size: 0.9em;
            color: var(--card-text-color);
        }
    
        .card-body .data-hora {
            color: #000000;
            font-size: 0.9em;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
    
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    
        .modal button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s, transform 0.3s;
        }
    
        .modal button:hover {
            background-color: #0056b3;
            transform: scale(1.1);
        }
    
        .task {
            background-color: var(--card-background);
            padding: 20px; /* Aumente o padding */
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: background-color 0.3s, color 0.3s;
        }
    
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #000000;
            padding-bottom: 10px;
            transition: border-color 0.3s;
        }
    
        .task-header h4 {
            margin: 0;
            font-size: 1.2em;
            color: #4e4376;
        }
    
        .task-header p {
            margin: 0;
            font-size: 0.9em;
            color: #555;
        }
    
        .task-body {
            padding-top: 10px;
        }
    
        .task-body p {
            margin: 5px 0;
            font-size: 0.9em;
            color: var(--card-text-color);
        }
    
        .task-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    
        .task-footer button {
        background-color: var(--button-background);
        color: var(--button-text-color);
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s;
    }

    .task-footer button:hover {
        background-color: var(--button-hover-background);
        transform: scale(1.1);
    }

    .toggle-button {
        background-image: url(olhoaberto.png); 
        background-color: transparent;
        color: white;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        padding: 10px; /* Espaço interno, caso queira adicionar mais espaço ao redor do texto */
        border: 2px solid transparent;
        font-size: 16px;
        cursor: pointer;
        width: 30px; /* Largura fixa */
        height: 100px; /* Altura fixa */
}
    
    .toggle-button:hover {
        color: #ffffff;
        transform: scale(1.1);
    }
    
        .blurred {
            filter: blur(5px);
        }
    
        .loading-bar-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 20px;
        }
    
        .loading-bar {
            width: 0;
            height: 20px;
            background-color: #4caf50;
            text-align: center;
            line-height: 20px;
            color: white;
            transition: width 0.3s;
        }
    
        .tasks-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
    
        .tarefa {
            background-color: var(--card-background);
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex: 1 1 calc(33.333% - 10px); /* Ajusta a largura para 3 colunas */
            box-sizing: border-box;
            transition: background-color 0.3s, transform 0.3s;
        }
    
        .tarefa:hover {
            transform: scale(1.02);
        }
    
        .tarefa h4 {
            margin: 0;
            font-size: 1.2em;
            color: var(--card-text-color);
        }
    
        .tarefa p {
            margin: 5px 0;
            color: var(--card-text-color);
        }
        /* Adicione este CSS ao seu arquivo CSS ou dentro de uma tag <style> no seu HTML */
    
        /* Estilo para os botões dentro dos cards */
        .card-buttons button {
            margin-right: 10px; /* Adiciona espaçamento à direita de cada botão */
        }
    
        .card-buttons button:last-child {
            margin-right: 0; /* Remove o espaçamento à direita do último botão */
        }
        .card-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
    
        .complete-task-button, .view-lead-details-button {
            background-color: var(--button-background);
            color: var(--button-text-color);
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
    
        .complete-task-button:hover, .view-lead-details-button:hover {
            background-color: var(--button-hover-background);
            transform: scale(1.1);
        }
    
        .view-lead-details-button i {
            font-size: 1.2em;
        }
        .centered-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .blurred {
            filter: blur(5px);
        }
        .select-container {
        position: relative;
        width: 100%;
        margin-bottom: 1rem;
    }

    .select-display {
        border: 1px solid #ccc;
        padding: 10px;
        cursor: pointer;
        background-color: linear-gradient(135deg, #4e4376, #6a5acd);
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .select-display::after {
        content: '▼';
        font-size: 12px;
        color: #888;
    }

    .select-options {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        border: 1px solid #ccc;
        background-color: #4e4376;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        border-radius: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-top: 5px;
    }

    .select-options div {
        padding: 10px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .select-options div:hover {
        background-color: #6a5acd;
    }

    .select-options div.selected {
        background-color: #6a5acd;
    }
    .date-input {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-right: 10px;
    }
    #applyFilterButton {
        background-color: var(--button-background);
        color: var(--button-text-color);
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.3s;
        margin-top: 10px; /* Adicione um pouco de margem superior para espaçamento */
    }
    
    #applyFilterButton:hover {
        background-color: var(--button-hover-background);
        transform: scale(1.1);
    }
    .vendedor-option {
        display: flex;
        align-items: center;
        padding: 10px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .vendedor-option:hover {
        background-color: #f1f1f1;
    }
    
    .vendedor-option input[type="checkbox"] {
        margin-right: 10px;
    }
    .img{
        margin-left: 10%;
    }
    .select-options {
    display: none;
    /* outros estilos */
}
/* Adicione este CSS ao seu arquivo CSS ou dentro de uma tag <style> no seu HTML */
.info-icon {
    margin-left: 5px;
    cursor: pointer;
    color: #6a5acd;
}

.info-icon:hover {
    color: #4e4376;
}

.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltiptext {
    visibility: hidden;
    width: 200px;
    background-color: #6a5acd;
    color: #fff;
    text-align: center;
    border-radius: 5px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%; /* Posiciona a tooltip acima do texto */
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
}

.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}
.header h1 {
    font-family: 'Merriweather', serif; /* Aplica a fonte Merriweather */
    font-size: 3em; /* Ajuste o tamanho conforme necessário */
    font-weight: 700; /* Negrito */
    color: var(--header-text-color); /* Mantém a cor existente */
    text-align: center; /* Centraliza o texto */
    letter-spacing: 1px; /* Adiciona espaçamento entre as letras */
}
.sidebar-bottom-buttons {
        display: flex;
        justify-content: space-between;
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        margin-top: auto; /* Garante que os botões fiquem no rodapé */
    }

    .sidebar-button {
        flex: 1;
        text-align: center;
        padding: 10px;
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    .sidebar-button i {
        margin-right: -5px; /* Reduz o espaçamento entre o ícone e o texto */
    }

    .sidebar-button span {
        margin-left: -5px; /* Reduz o espaçamento entre o texto e o ícone */
    }

    .sidebar-button:first-child {
        margin-right: 5px;
    }

    .sidebar-button:last-child {
        margin-left: 5px;
    }
    .step.no-hover:hover {
    background: var(--card-background);
    transform: none;
}
.step.active {
    background: var(--button-background);
    color: var(--button-text-color);
    margin-left: 50px;
}
.step.no-hover:hover {
    background: var(--card-background);
    transform: none;
}
.step.disabled {
    pointer-events: none;
    opacity: 1;
}
.menu-item {
    position: relative;
}
.sidebar:not(:hover) .subcategory-sidebar {
    display: none !important; /* Garante que o submenu seja ocultado */
}
#homeChevron {
    transition: transform 0.3s ease;
}
.sidebar a#homeLink {
    display: flex;
    align-items: center;
    justify-content: flex-start; /* Alinha o conteúdo à esquerda */
    padding: 15px 20px; /* Aumenta o espaço interno */
    width: 100%; /* Garante que o botão ocupe toda a largura disponível */
    box-sizing: border-box; /* Inclui o padding na largura total */
    overflow: hidden; /* Evita que o conteúdo transborde */
    gap: 1px; /* Adiciona espaço entre o ícone e o texto */
}
.sidebar:not(:hover) #homeChevron {
    display: none; /* Esconde o ícone quando a sidebar está colapsada */
}

/* Mantém o submenu visível enquanto o mouse está sobre o item principal ou o submenu */
.menu-item:hover .subcategory-sidebar,
.subcategory-sidebar:hover {
    display: none;
}
.subcategory-sidebar {
    display: none; /* Esconde o submenu por padrão */
    position: absolute; /* Posiciona em relação ao botão pai */
    top: 0; /* Alinha ao topo do botão pai */
    left: 100%; /* Posiciona ao lado direito do botão pai */
    background: var(--sidebar-background);
    color: var(--sidebar-text-color);
    padding: 10px;
    flex-direction: column;
    gap: 10px;
    width: 250px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    transition: all 0.3s ease;
}
#relatoriosSubcategoriesSidebar {
    display: none; /* Esconde o submenu por padrão */
    position: absolute; /* Posiciona em relação ao elemento pai */
    top: 29%; /* Alinha ao topo do item pai */
    left: 100%; /* Ajusta para a largura da sidebar expandida */
    background: var(--sidebar-background);
    color: var(--sidebar-text-color);
    padding: 10px;
    flex-direction: column;
    gap: 10px;
    width: 250px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    transition: all 0.3s ease;
}
#homeSubcategoriesSidebar {
    top: 10%; /* Ajuste a posição vertical conforme necessário */
    left: 123%; /* Ajuste a posição horizontal conforme necessário */
    position: absolute; /* Garante que a posição seja relativa ao elemento pai */
    z-index: 1001; /* Certifique-se de que está acima de outros elementos */
}
#relatoriosSubcategoriesSidebar {
    position: fixed; /* Fixa o submenu na tela */
    top: 200px; /* Ajuste para alinhar verticalmente com o botão "Relatórios" */
    left: 219px; /* Ajuste para alinhar horizontalmente ao lado da sidebar expandida */
    z-index: 1001; /* Certifique-se de que está acima de outros elementos */
    display: none; /* Esconde o submenu por padrão */
    background: var(--sidebar-background);
    color: var(--sidebar-text-color);
    padding: 10px;
    flex-direction: column;
    gap: 10px;
    width: 250px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}
#comercialSubcategoriesSidebar {
    display: none; /* Esconde o submenu por padrão */
    position: absolute; /* Posiciona em relação ao botão pai */
    top: 0; /* Alinha ao topo do botão pai */
    left: 100%; /* Posiciona ao lado direito do botão pai */
    background: var(--sidebar-background);
    color: var(--sidebar-text-color);
    padding: 10px;
    flex-direction: column;
    gap: 10px;
    width: 250px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    transition: all 0.3s ease;

    /* Centraliza os itens */
    display: flex;
    align-items: center; /* Alinha horizontalmente ao centro */
    justify-content: center; /* Alinha verticalmente ao centro */
}
#agenda .card {
    background: linear-gradient(135deg, #f0f0f0, #d0d0d0); /* Gradiente para os cards */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: background-color 0.3s, color 0.3s;
    min-height: 150px; /* Define uma altura mínima para todos os cards */
    justify-content: center; /* Centraliza o conteúdo verticalmente */
    align-items: center; /* Centraliza o conteúdo horizontalmente */
    text-align: center; /* Centraliza o texto */
    border-top: 5px solid #6a5acd; /* Adiciona uma borda superior roxa */
}
#agenda .card,
#agenda .card.empty {
    width: 201px;
    height: 336px;
    box-sizing: border-box; /* Inclui padding e borda no tamanho total */
    justify-content: center; /* Centraliza o conteúdo horizontalmente */
    align-items: center; /* Centraliza o conteúdo verticalmente */
    margin: 10px auto; /* Adiciona margem automática para centralizar */
}

/* Responsividade para telas menores */
@media (max-width: 768px) {
    #agenda .card,
    #agenda .card.empty {
        width: 100%; /* Ocupa toda a largura disponível */
        height: auto; /* Ajusta a altura automaticamente */
        margin: 10px 0; /* Adiciona espaçamento vertical */
    }

    .tasks-container {
        flex-direction: column; /* Empilha os elementos verticalmente */
        align-items: center; /* Centraliza os elementos */
    }
}
.day-column {
    background: white; /* Gradiente de laranja */
    padding: 10px;
    margin: 10px;
    border-radius: 5px;
    color: #333; /* Cor do texto */
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s, color 0.3s;
}
.card-header {
    background-color: white; /* Cor de fundo amarela */
    color: black;
    font-weight: bold;
    padding: 10px;
    border-radius: 5px 5px 0 0; /* Bordas arredondadas no topo */
}

/* Estilo para o texto dentro do card */
.card p {
    color: black;
    font-size: 1em;
    margin: 10px 0;
}
.day-column h4 {
    color: black; /* Cor verde */
    font-size: 1.5em; /* Aumenta o tamanho da fonte */
    font-weight: bold; /* Negrito */
    text-align: center; /* Centraliza o texto */
    text-transform: uppercase; /* Transforma o texto em maiúsculas */
}
#agenda .card {
    background: linear-gradient(135deg, #f0f0f0, #d0d0d0); /* Gradiente para os cards */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    transition: background-color 0.3s, color 0.3s;
    min-height: 150px; /* Define uma altura mínima para todos os cards */
    justify-content: center; /* Centraliza o conteúdo verticalmente */
    align-items: center; /* Centraliza o conteúdo horizontalmente */
    text-align: center; /* Centraliza o texto */
}
#agenda .card p{
    font-size: 0.8em; /* Reduz o tamanho da fonte */
    margin: 5px 0; /* Ajusta o espaçamento */
    color: #333; /* Mantém a cor do texto */
}
.card.empty .card-buttons button {
    visibility: hidden; /* Torna os botões invisíveis */
    pointer-events: none; /* Desativa a interação com os botões */
}
.card-buttons button {
    background-color: var(--button-background);
    color: var(--button-text-color);
    border: none;
    padding: 5px 10px; /* Reduz o padding para diminuir o botão */
    font-size: 0.8em; /* Reduz o tamanho da fonte */
    border-radius: 3px; /* Ajusta o arredondamento */
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
}

.card-buttons button:hover {
    background-color: var(--button-hover-background);
    transform: scale(1.05); /* Ajusta o efeito de hover */
}

/* Ajuste para os botões dentro de .card.empty */
.card.empty .card-buttons button {
    visibility: hidden; /* Mantém os botões invisíveis, se necessário */
    pointer-events: none;
}
.day-column {
    display: inline-block; /* Permite que as colunas fiquem lado a lado */
    width: calc(50% - 10px); /* Ajuste o tamanho para caber duas colunas */
    margin: 5px; /* Espaçamento entre as colunas */
    vertical-align: top; /* Alinha as colunas no topo */
}
.card, .card.empty {
    display: flex;
    flex-direction: column; /* Organiza os elementos verticalmente */
    justify-content: space-between; /* Garante espaçamento entre os elementos */
    align-items: center; /* Centraliza os elementos horizontalmente */
    width: 100%; /* Ajusta a largura para ocupar o espaço disponível */
    max-width: 300px; /* Define uma largura máxima */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s, color 0.3s;
    text-align: center; /* Centraliza o texto */
    box-sizing: border-box; /* Inclui padding e borda no tamanho total */
}

.card-header {
    font-weight: bold;
    font-size: 1.2em;
    color: #000000;
    margin-bottom: 10px; /* Espaçamento inferior */
    text-align: center;
    border: 0% 100% 0% 100%;
}

.card-body {
    flex: 1; /* Permite que o corpo ocupe o espaço restante */
    display: flex;
    flex-direction: column;
    justify-content: center; /* Centraliza verticalmente o conteúdo */
    align-items: center; /* Centraliza horizontalmente o conteúdo */
    gap: 10px; /* Espaçamento entre os elementos */
}

.card-buttons {
    display: flex;
    justify-content: center; /* Centraliza os botões horizontalmente */
    gap: 10px; /* Espaçamento entre os botões */
    margin-top: 10px; /* Espaçamento superior */
}

.card-buttons button {
    background-color: var(--button-background);
    color: var(--button-text-color);
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
}

.card-buttons button:hover {
    background-color: var(--button-hover-background);
    transform: scale(1.1);
}

.responsavel-lead {
    margin-top: 10px; /* Espaçamento superior */
    font-size: 0.9em;
    color: #555;
    text-align: center;
}
    </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyAKPIufxUNS2kHSErxCLANWev4w06-RfwY",
  authDomain: "cotafacil-b0489.firebaseapp.com",
  projectId: "cotafacil-b0489",
  storageBucket: "cotafacil-b0489.firebasestorage.app",
  messagingSenderId: "201488478427",
  appId: "1:201488478427:web:a334256656ec8fa53d5cfe",
  measurementId: "G-9BDP1YLJLE"
};

    firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const chartInstances = {};

    function toggleTheme() {
        const isDarkMode = document.body.classList.toggle('dark-mode');
        const newTheme = isDarkMode ? 'dark' : 'clean';
        auth.onAuthStateChanged((user) => {
            if (user) {
                db.collection('users').doc(user.email).update({ theme: newTheme })
                    .catch((error) => console.error('Erro ao atualizar tema:', error));
            }
        });
    }

    async function fetchData(vendedor, collection) {
        const doc = await db.collection(collection).doc(vendedor).get();
        if (!doc.exists) {
            return null;
        }
        return doc.data();
    }

    async function renderChart(ctx, type, labels, datasets, options) {
        if (chartInstances[ctx.canvas.id]) {
            chartInstances[ctx.canvas.id].destroy();
        }
        chartInstances[ctx.canvas.id] = new Chart(ctx, { type, data: { labels, datasets }, options });
    }

    async function renderVendasComercialChart(vendedor) {
        const vendasData = await fetchData('relatorios', vendedor);
        if (!vendasData) return;
    
        const currentYear = new Date().getFullYear();
        const lastYear = currentYear - 1;
        const data = { [currentYear]: Array(12).fill(0), [lastYear]: Array(12).fill(0) };
    
        for (const [key, value] of Object.entries(vendasData)) {
            const [year, month] = key.split('-').map(Number);
            if (year === currentYear || year === lastYear) {
                data[year][month - 1] = value;
            }
        }
    
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const datasets = [
            {
                label: `${lastYear}`,
                data: data[lastYear],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            },
            {
                label: `${currentYear}`,
                data: data[currentYear],
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }
        ];
    
        renderChart(document.getElementById('relatorioComercialChart').getContext('2d'), 'bar', labels, datasets, {
            responsive: true,
            scales: { y: { beginAtZero: true } }
        });
    }

    async function renderVendasCancelamentoChart(vendedor) {
        const vendasData = await fetchData('relatoriocancelados', vendedor);
        if (!vendasData) return;
    
        const currentYear = new Date().getFullYear();
        const lastYear = currentYear - 1;
        const data = { [currentYear]: Array(12).fill(0), [lastYear]: Array(12).fill(0) };
    
        for (const [key, value] of Object.entries(vendasData)) {
            const [year, month] = key.split('-').map(Number);
            if (year === currentYear || year === lastYear) {
                data[year][month - 1] = value;
            }
        }
    
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const datasets = [
            {
                label: `${lastYear}`,
                data: data[lastYear],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            },
            {
                label: `${currentYear}`,
                data: data[currentYear],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }
        ];
    
        renderChart(document.getElementById('relatorioCancelamentoChart').getContext('2d'), 'bar', labels, datasets, {
            responsive: true,
            scales: { y: { beginAtZero: true } }
        });
    }

    async function fetchADMData(vendedor) {
        const relatorioAdmRef = db.collection('relatorioadm').doc(vendedor).collection('administradoras');
        const snapshot = await relatorioAdmRef.get();

        if (snapshot.empty) {
            return null;
        }

        const admData = {};
        snapshot.forEach(doc => {
            const data = doc.data();
            const administradora = doc.id;

            admData[administradora] = Object.values(data).reduce((acc, value) => acc + value, 0);
        });

        return admData;
    }

    async function renderADMChart(vendedor) {
        const admData = await fetchADMData(vendedor);
        if (!admData) return;

        if (chartInstances['relatorioADMChart']) {
            chartInstances['relatorioADMChart'].destroy();
        }

        const labels = Object.keys(admData);
        const data = Object.values(admData);

        chartInstances['relatorioADMChart'] = new Chart(document.getElementById('relatorioADMChart').getContext('2d'), {
            type: 'pie',
            data: {
                labels: Array.isArray(labels) ? labels : [],
                datasets: [{
                    data: Array.isArray(data) ? data : [],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true
            }
        });
    }

    async function fetchTopClients(vendedor) {
        const snapshot = await db.collection('relatorioclientes').doc(vendedor).collection('clientes').get();
        const clientSales = [];

        snapshot.forEach(doc => {
            const data = doc.data();
            const totalSales = Object.values(data).reduce((sum, value) => sum + value, 0);
            clientSales.push({ cliente: doc.id, totalSales });
        });

        clientSales.sort((a, b) => b.totalSales - a.totalSales);
        const topClients = clientSales.slice(0, 5);

        const labels = topClients.map(client => client.cliente);
        const data = topClients.map(client => client.totalSales);

        renderChart(document.getElementById('relatorioClientesChart').getContext('2d'), 'pie', labels, [{
            label: '',
            data,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
        }], {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Top 5 Clientes por Volume de Vendas' }
            }
        });
    }

    async function fetchTopProducts(vendedor) {
        const snapshot = await db.collection('relatorioprodutos').doc(vendedor).collection('produtos').get();
        const productSales = [];

        snapshot.forEach(doc => {
            const data = doc.data();
            const totalSales = Object.values(data).reduce((sum, value) => sum + value, 0);
            productSales.push({ produto: doc.id, totalSales });
        });

        productSales.sort((a, b) => b.totalSales - a.totalSales);
        const topProducts = productSales.slice(0, 5);

        const labels = topProducts.map(product => product.produto);
        const data = topProducts.map(product => product.totalSales);

        renderChart(document.getElementById('relatorioProdutosChart').getContext('2d'), 'pie', labels, [{
            label: '',
            data,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }], {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Top 5 Produtos por Volume de Vendas' }
            }
        });
    }
    
    function renderComissaoChart(labels, datasets) {
        const ctx = document.getElementById('relatorioComissaoChart').getContext('2d');
    
        // Destroy the existing chart instance if it exists
        if (chartInstances['relatorioComissaoChart']) {
            chartInstances['relatorioComissaoChart'].destroy();
        }
    
        chartInstances['relatorioComissaoChart'] = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    async function carregarTarefasSemana(semana) {
    const user = firebase.auth().currentUser;
    if (!user) {
        return;
    }

    const userDoc = await db.collection('users').doc(user.email).get();
    if (!userDoc.exists) {
        console.error("Usuário não encontrado no Firestore!");
        return;
    }

    const userData = userDoc.data();
    const userName = userData.name; // Nome do usuário logado
    const userRole = userData.role; // Papel do usuário logado

    const tarefasContainer = document.getElementById('tarefasContainer');
    tarefasContainer.innerHTML = ''; // Limpar tarefas anteriores

    // Converter a string 'YYYY-WW' para uma data de início da semana
    const [year, week] = semana.split('-W').map(Number);
    const startOfWeek = new Date(year, 0, (week - 1) * 7 + 1);
    const dayOfWeek = startOfWeek.getDay();
    const diff = startOfWeek.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // Ajuste para segunda-feira
    startOfWeek.setDate(diff);

    if (isNaN(startOfWeek.getTime())) {
        console.error("Data inválida fornecida para a semana.");
        return;
    }
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 5); // Ajuste para sábado

    // Convertendo as datas para Timestamp do Firestore
    const startOfWeekTimestamp = firebase.firestore.Timestamp.fromDate(startOfWeek);
    const endOfWeekTimestamp = firebase.firestore.Timestamp.fromDate(endOfWeek);

    try {
        const tarefasSnapshot = await db.collectionGroup('tarefas')
            .where('dataHora', '>=', startOfWeekTimestamp)
            .where('dataHora', '<=', endOfWeekTimestamp)
            .where('concluida', '==', false) // Filtrar apenas tarefas não concluídas
            .get();

        const daysOfWeek = ['Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira'];
        const dayColumns = {};

        daysOfWeek.forEach((day, index) => {
            const dayColumn = document.createElement('div');
            dayColumn.classList.add('day-column');
            dayColumn.setAttribute('data-day-index', index); // Índice do dia da semana
            dayColumn.innerHTML = `<h4>${day}</h4>`;
            tarefasContainer.appendChild(dayColumn);
            dayColumns[index] = dayColumn; // Mapear o índice ao elemento
        });

        tarefasSnapshot.forEach(async (doc) => {
            const tarefa = doc.data();
            const tarefaDate = tarefa.dataHora.toDate(); // Converter Firestore Timestamp para Date
            const tarefaDayIndex = (tarefaDate.getDay() + 6) % 7; // Ajustar para segunda-feira como primeiro dia (0 = segunda)

            // Verificar se o usuário logado pode visualizar a tarefa
            if (
                userRole !== 'gestor-administrativo' &&
                userRole !== 'gestor-comercial' &&
                userRole !== 'proprietario-socio' &&
                tarefa.responsavel !== userName
            ) {
                return; // Ignorar tarefas que não pertencem ao usuário logado
            }

            const tarefaCard = document.createElement('div');
            tarefaCard.classList.add('card');
            tarefaCard.setAttribute('data-task-id', doc.id);

            // Obter o nome do usuário a partir do e-mail
            let responsavelNome = 'Não atribuído';
            if (tarefa.usuario) {
                const responsavelDoc = await db.collection('users').doc(tarefa.usuario).get();
                if (responsavelDoc.exists) {
                    responsavelNome = responsavelDoc.data().name || 'Não atribuído';
                }
            }

            tarefaCard.innerHTML = `
                <div class="card-header">${tarefa.nomeCliente || 'Sem nome'}</div>
                <div class="card-body">
                    <p>${tarefa.descricao || 'Sem descrição'}</p>
                    <p class="data-hora"><strong>${tarefaDate.toLocaleString('pt-BR')}</strong></p>
                </div>
                <div class="card-buttons">
                    <button class="complete-task-button" onclick="marcarComoConcluida('${doc.ref.parent.parent.id}', '${doc.id}')">Concluir</button>
                </div>
                <div class="responsavel-lead">
                    <p><strong>Responsável:</strong> ${responsavelNome}</p>
                </div>
            `;

            // Adicionar a tarefa à coluna correspondente
            if (dayColumns[tarefaDayIndex]) {
                dayColumns[tarefaDayIndex].appendChild(tarefaCard);

                // Adicionar linha de separação
                const separator = document.createElement('hr');
                separator.style.border = '1px dashed #ccc'; // Linha tracejada
                separator.style.margin = '10px 0'; // Espaçamento
                dayColumns[tarefaDayIndex].appendChild(separator);
            }
        });

        // Adicionar um card vazio para dias sem tarefas
        Object.keys(dayColumns).forEach(dayIndex => {
            const dayColumn = dayColumns[dayIndex];
            const hasVisibleTasks = Array.from(dayColumn.querySelectorAll('.card:not(.empty)')).some(card => {
                const responsavel = card.querySelector('.responsavel-lead p strong')?.nextSibling?.textContent?.trim();
                // Verifica se o usuário pode visualizar a tarefa
                if (userRole === 'proprietario-socio' || userRole === 'gestor-comercial') {
                    return true; // Proprietário ou gestor comercial vê todas as tarefas
                }
                return responsavel === userName; // Outros usuários veem apenas suas próprias tarefas
            });

            if (!hasVisibleTasks) {
            } else {
                // Remove o aviso "Sem tarefas" se já existir e houver tarefas visíveis
                const emptyCard = dayColumn.querySelector('.card.empty');
                if (emptyCard) {
                    dayColumn.removeChild(emptyCard);
                }
            }
        });
    } catch (error) {
        console.error("Erro ao carregar tarefas:", error);
    }
}

function marcarComoConcluida(leadId, tarefaId) {
    db.collection('leads').doc(leadId).collection('tarefas').doc(tarefaId).update({
        concluida: true
    }).then(() => {
        alert('Tarefa marcada como concluída!');
        const currentWeek = document.getElementById('semana').value;
        carregarTarefasSemana(currentWeek); // Recarregar a lista de tarefas
    }).catch((error) => {
        console.error('Erro ao marcar tarefa como concluída:', error);
        alert('Erro ao marcar tarefa como concluída. Tente novamente.');
    });
}

document.addEventListener('DOMContentLoaded', () => {
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            try {
                const doc = await db.collection('users').doc(user.email).get();
                if (doc.exists) {
                    const userData = doc.data();
                    const userNameElement = document.getElementById('userName');
                    const semanaElement = document.getElementById('semana');
                    const sidebar = document.getElementById('sidebar');
                    const homeSubcategories = document.getElementById('homeSubcategories');
                    const homeLink = document.getElementById('homeLink');

                    if (userNameElement && semanaElement) {
                        userNameElement.textContent = userData.name;

                        const currentTheme = userData.theme || 'clean';
                        document.body.classList.toggle('dark-mode', currentTheme === 'dark');

                        if (userData.role === 'admin') {
                            const vendedorFilterGroup = document.getElementById('vendedorFilterGroup');
                            if (vendedorFilterGroup) {
                                vendedorFilterGroup.style.display = 'block';
                                await populateVendedores(); // Preencher os vendedores no filtro
                                updateVendedorSelectDisplay(); // Atualizar a exibição do seletor de vendedores
                            } else {
                                console.error("Elemento 'vendedorFilterGroup' não encontrado no DOM.");
                            }
                        }

                        // Adicionar subcategorias na Home baseadas no papel do usuário
                        if (['gestor-comercial', 'gestor-administrativo', 'proprietario-socio'].includes(userData.role)) {
                            homeSubcategories.style.display = 'block';
                            if (homeLink) {
                                homeLink.addEventListener('click', (event) => {
                                    event.preventDefault();
                                    homeSubcategories.style.display = homeSubcategories.style.display === 'none' ? 'block' : 'none';
                                });
                            } else {
                                console.error("Elemento 'homeLink' não encontrado no DOM.");
                            }
                        }

                        const currentWeek = new Date().toISOString().slice(0, 10);
                        const currentWeekFormatted = `${currentWeek.substring(0, 4)}-W${String(Math.ceil((new Date(currentWeek).getDate() + 6) / 7)).padStart(2, '0')}`;
                        semanaElement.value = currentWeekFormatted;
                        carregarTarefasSemana(currentWeekFormatted);
                    } else {
                        console.error("Elementos necessários não encontrados no DOM.");
                    }
                } else {
                    console.error("Documento do usuário não encontrado.");
                }
            } catch (error) {
                console.error("Erro ao carregar dados do usuário:", error);
            }
        } else {
            console.warn("Nenhum usuário autenticado.");
        }
    });

    // Configuração do comportamento da sidebar
    const sidebar = document.getElementById('sidebar');
    const homeSubmenu = document.getElementById('homeSubcategoriesSidebar');
    const relatoriosSubmenu = document.getElementById('relatoriosSubcategoriesSidebar');
    const comercialSubmenu = document.getElementById('comercialSubcategoriesSidebar');
    const homeChevron = document.getElementById('homeChevron');
    const relatoriosChevron = relatoriosSubmenu?.previousElementSibling.querySelector('.fas.fa-chevron-down');
    const comercialChevron = comercialSubmenu?.previousElementSibling.querySelector('.fas.fa-chevron-down');

    if (sidebar) {
        sidebar.addEventListener('mouseleave', () => {
            // Fecha o submenu "Home" se estiver aberto
            if (homeSubmenu && homeSubmenu.style.display === 'block') {
                homeSubmenu.style.display = 'none';
                if (homeChevron) {
                    homeChevron.style.transform = 'rotate(0deg)'; // Reseta o ícone
                }
            }

            // Fecha o submenu "Relatórios" se estiver aberto
            if (relatoriosSubmenu && relatoriosSubmenu.style.display === 'block') {
                relatoriosSubmenu.style.display = 'none';
                if (relatoriosChevron) {
                    relatoriosChevron.style.transform = 'rotate(0deg)'; // Reseta o ícone
                }
            }

            // Fecha o submenu "Comercial" se estiver aberto
            if (comercialSubmenu && comercialSubmenu.style.display === 'block') {
                comercialSubmenu.style.display = 'none';
                if (comercialChevron) {
                    comercialChevron.style.transform = 'rotate(0deg)'; // Reseta o ícone
                }
            }
        });
    } else {
        console.error("Elemento 'sidebar' não encontrado.");
    }

    // Configuração do botão de logout
    const sidebarLogoutButton = document.getElementById('sidebarLogoutButton');
    if (sidebarLogoutButton) {
        sidebarLogoutButton.addEventListener('click', () => {
            auth.signOut().then(() => {
                window.location.href = 'login.html'; // Redirecionar para a página de login após logout
            }).catch((error) => {
                console.error('Erro ao fazer logout:', error);
            });
        });
    } else {
        console.error("Elemento com ID 'sidebarLogoutButton' não encontrado.");
    }
});

async function applyVendedorFilter() {
    // Obter as datas de início e fim do filtro
    const startDateInput = document.getElementById('startDate').value;
    const endDateInput = document.getElementById('endDate').value;

    if (!startDateInput || !endDateInput) {
        alert("Por favor, selecione um período válido.");
        return;
    }

    const startDate = new Date(startDateInput);
    let endDate = new Date(endDateInput);

    if (isNaN(startDate) || isNaN(endDate)) {
        alert("Por favor, selecione um período válido.");
        return;
    }

    // Ajustar endDate para incluir o dia completo
    endDate.setHours(23, 59, 59, 999);

    // Obter os vendedores selecionados no filtro
    const vendedorSelect = document.getElementById('filterVendedor');
    let vendedores = [];

    if (vendedorSelect && vendedorSelect.selectedOptions.length > 0) {
        vendedores = Array.from(vendedorSelect.selectedOptions).map(option => option.value);
    } else {
        // Se nenhum vendedor for selecionado, usar o vendedor logado
        const user = firebase.auth().currentUser;
        if (user) {
            const userDoc = await db.collection('users').doc(user.email).get();
            if (userDoc.exists) {
                vendedores = [userDoc.data().name];
            }
        }
    }

    if (vendedores.length === 0) {
        alert("Nenhum vendedor selecionado.");
        return;
    }

    try {
        // Limpar os dados anteriores e exibir ícones de carregamento
        resetCardsAndCharts();

        // Atualizar o valor das metas do período filtrado
        await updateTotalSalesTarget(vendedores, startDate, endDate);

        // Destruir todas as instâncias de gráficos existentes
        Object.keys(chartInstances).forEach(chartId => {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
                delete chartInstances[chartId];
            }
        });

        // Renderizar novos gráficos com os dados combinados dos vendedores selecionados e período
        await renderCombinedVendasComercialChart(vendedores, startDate, endDate);
        await renderCombinedVendasCancelamentoChart(vendedores, startDate, endDate);
        await renderCombinedADMChart(vendedores, startDate, endDate);
        await fetchCombinedTopClients(vendedores, startDate, endDate);
        await fetchCombinedTopProducts(vendedores, startDate, endDate);
        await fetchCombinedCommissions(vendedores, startDate, endDate);

        // Atualizar os valores dos cards
        await updateTotalVendas(vendedores, startDate, endDate);
        await updateTotalCotas(vendedores, startDate, endDate);
        await updateTotalComissao(vendedores, startDate, endDate);
        updateTicketMedio();
    } catch (error) {
        console.error("Erro ao aplicar o filtro:", error);
        alert("Ocorreu um erro ao aplicar o filtro. Por favor, tente novamente.");
    }
}

// Função para limpar os dados anteriores e exibir ícones de carregamento
function resetCardsAndCharts() {
    // Exibir ícone de carregamento nos cards
    document.getElementById('totalSalesTarget').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('salesCount').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('cotasCount').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('ticketMedio').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('clientesTotal').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    document.getElementById('comissaoTotal').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

    // Exibir ícone de carregamento nos gráficos
    const chartContainers = document.querySelectorAll('.chart-container canvas');
    chartContainers.forEach(canvas => {
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpar o gráfico anterior
        ctx.font = '16px Arial';
        ctx.fillStyle = '#999';
        ctx.textAlign = 'center';
        ctx.fillText('Carregando...', canvas.width / 2, canvas.height / 2);
    });
}


async function fetchCombinedCommissions(vendedores) {
    const monthlyCommissions = {};
    const noDateCommissions = {};
    let totalContemplacao = 0;
    let totalFaturamento = 0;

    for (const vendedor of vendedores) {
        const snapshot = await db.collection('ComissaoID').where('vendedor', '==', vendedor).get();
        for (const doc of snapshot.docs) {
            const data = doc.data();
            const years = ['2022', '2023', '2024', '2025']; // Adicione mais anos conforme necessário
            for (const year of years) {
                const yearCollection = await doc.ref.collection(year).get();
                if (!yearCollection.empty) {
                    for (const monthDoc of yearCollection.docs) {
                        const monthData = monthDoc.data();
                        if (monthData.dataVencimento) {
                            const date = new Date(monthData.dataVencimento.toDate());
                            const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                            const commission = monthData.valor;

                            if (!monthlyCommissions[monthYear]) {
                                monthlyCommissions[monthYear] = 0;
                            }

                            monthlyCommissions[monthYear] += commission;
                        } else {
                            const commission = monthData.valor;
                            if (!noDateCommissions[monthDoc.id]) {
                                noDateCommissions[monthDoc.id] = 0;
                            }
                            noDateCommissions[monthDoc.id] += commission;
                        }
                    }
                }
            }
        }
    }

    totalContemplacao = await somarContemplacao(vendedores);
    totalFaturamento = await somarFaturamento(vendedores);

    // Adicionar os totais de CONTEMPLAÇÃO e FATURAMENTO ao objeto monthlyCommissions
    if (totalContemplacao > 0) {
        monthlyCommissions['CONTEMPLAÇÃO'] = totalContemplacao;
    }
    if (totalFaturamento > 0) {
        monthlyCommissions['FATURAMENTO'] = totalFaturamento;
    }

    // Ordenar os dados cronologicamente
    const sortedMonthlyCommissions = Object.keys(monthlyCommissions).sort((a, b) => {
        const [aMonth, aYear] = a.split('/').map(Number);
        const [bMonth, bYear] = b.split('/').map(Number);
        return new Date(aYear, aMonth - 1) - new Date(bYear, bMonth - 1);
    }).reduce((obj, key) => {
        obj[key] = monthlyCommissions[key];
        return obj;
    }, {});

    // Adicionar comissões sem data no final
    Object.keys(noDateCommissions).forEach(key => {
        sortedMonthlyCommissions[key] = noDateCommissions[key];
    });

    const labels = Object.keys(sortedMonthlyCommissions);
    const data = Object.values(sortedMonthlyCommissions);

    const datasets = [
        {
            label: 'Comissões',
            data: data,
            backgroundColor: 'rgba(153, 102, 255, 0.2)',
            borderColor: 'rgba(153, 102, 255, 1)',
            borderWidth: 1
        }
    ];

    renderComissaoChart(labels, datasets);
}

async function somarContemplacao(vendedores) {
    let totalContemplacao = 0;
    for (const vendedor of vendedores) {
        const snapshot = await db.collection('ComissaoID').where('vendedor', '==', vendedor).get();
        for (const doc of snapshot.docs) {
            const specialDoc = await doc.ref.collection('CONTEMPLAÇÃO').get();
            if (!specialDoc.empty) {
                for (const specialDocItem of specialDoc.docs) {
                    const specialData = specialDocItem.data();
                    if (specialData.valor) {
                        totalContemplacao += specialData.valor;
                    }
                }
            }
        }
    }
    return totalContemplacao;
}

async function somarFaturamento(vendedores) {
    let totalFaturamento = 0;
    for (const vendedor of vendedores) {
        const snapshot = await db.collection('ComissaoID').where('vendedor', '==', vendedor).get();
        for (const doc of snapshot.docs) {
            const specialDoc = await doc.ref.collection('FATURAMENTO').get();
            if (!specialDoc.empty) {
                for (const specialDocItem of specialDoc.docs) {
                    const specialData = specialDocItem.data();
                    if (specialData.valor) {
                        totalFaturamento += specialData.valor;
                    }
                }
            }
        }
    }
    return totalFaturamento;
}

function renderComissaoChart(labels, datasets) {
    const ctx = document.getElementById('relatorioComissaoChart').getContext('2d');

    // Destroy the existing chart instance if it exists
    if (chartInstances['relatorioComissaoChart']) {
        chartInstances['relatorioComissaoChart'].destroy();
    }

    chartInstances['relatorioComissaoChart'] = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: datasets
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Adicionar seções de CONTEMPLAÇÃO e FATURAMENTO
    const contemplationSection = document.createElement('div');
    contemplationSection.innerHTML = `
        <h2>CONTEMPLAÇÃO</h2>
        <p>Total: ${datasets[0].data[labels.indexOf('CONTEMPLAÇÃO')]}</p>
    `;
    ctx.canvas.parentNode.appendChild(contemplationSection);

    const faturamentoSection = document.createElement('div');
    faturamentoSection.innerHTML = `
        <h2>FATURAMENTO</h2>
        <p>Total: ${datasets[0].data[labels.indexOf('FATURAMENTO')]}</p>
    `;
    ctx.canvas.parentNode.appendChild(faturamentoSection);
}
   
function updateVendedorSelectDisplay() {
    const vendedorSelect = document.getElementById('filterVendedor');
    const selectDisplay = document.getElementById('vendedorSelectDisplay');
    const selectedOptions = Array.from(vendedorSelect.selectedOptions).map(option => option.value);

    const roles = {
        'vendedor-interno': 'Vendedores Internos',
        'vendedor-externo': 'Vendedores Externos',
        'indicador': 'Indicadores'
    };

    if (selectedOptions.includes('all')) {
        selectDisplay.textContent = 'Todos os Vendedores';
    } else if (selectedOptions.includes('vendedor-interno')) {
        selectDisplay.textContent = 'Vendedores Internos';
    } else if (selectedOptions.some(option => roles[option])) {
        const selectedRole = selectedOptions.find(option => roles[option]);
        selectDisplay.textContent = roles[selectedRole];
    } else if (selectedOptions.length > 0) {
        selectDisplay.innerHTML = '';
        const container = document.createElement('div');
        container.style.display = 'flex';
        container.style.flexWrap = 'wrap';
        selectedOptions.forEach((optionText, index) => {
            const span = document.createElement('span');
            span.textContent = optionText + (index < selectedOptions.length - 1 ? ', ' : ''); // Adicionar vírgula e espaço entre os nomes
            span.style.cursor = 'pointer';
            span.style.padding = '0'; // Remover qualquer padding
            span.style.whiteSpace = 'nowrap'; // Evitar quebra de linha
            span.addEventListener('click', () => {
                const option = Array.from(vendedorSelect.options).find(opt => opt.value === optionText);
                if (option) {
                    option.selected = false;
                    updateVendedorSelectDisplay();
                }
            });
            container.appendChild(span);
        });
        selectDisplay.appendChild(container);
    } else {
        selectDisplay.textContent = 'Selecione os vendedores';
    }
}

async function populateVendedores() {
    const vendedorSelect = document.getElementById('filterVendedor');
    const vendedorOptionsContainer = document.getElementById('vendedorOptions');
    if (!vendedorSelect || !vendedorOptionsContainer) {
        console.error("Elementos de filtro de vendedor não encontrados no DOM.");
        return;
    }
    vendedorSelect.innerHTML = ''; // Limpa a lista de vendedores antes de preenchê-la
    vendedorOptionsContainer.innerHTML = ''; // Limpa as opções de vendedores antes de preenchê-las

    // Adicionar a opção "Todos os Vendedores"
    const allOption = document.createElement('option');
    allOption.value = 'all';
    allOption.textContent = 'Todos os Vendedores';
    vendedorSelect.appendChild(allOption);

    const allOptionDiv = document.createElement('div');
    allOptionDiv.classList.add('vendedor-option');
    allOptionDiv.innerHTML = `
        <input type="checkbox" id="checkbox-all" />
        <label for="checkbox-all" class="vendedor-label">Todos os Vendedores</label>
    `;
    allOptionDiv.addEventListener('click', (event) => {
        const checkbox = document.getElementById('checkbox-all');
        checkbox.checked = !checkbox.checked;
        const allSelected = checkbox.checked;
        Array.from(vendedorSelect.options).forEach(option => {
            option.selected = allSelected;
        });
        document.querySelectorAll('.vendedor-option input[type="checkbox"]').forEach(cb => {
            cb.checked = allSelected;
        });
        updateVendedorSelectDisplay();
    });
    vendedorOptionsContainer.appendChild(allOptionDiv);

    // Adicionar opções específicas para cada role
    const roles = [
        { value: 'vendedor-interno', label: 'Vendedores Internos' },
        { value: 'vendedor-externo', label: 'Vendedores Externos' },
        { value: 'indicador', label: 'Indicadores' }
    ];

    const roleVendedores = {};

    for (const role of roles) {
        roleVendedores[role.value] = [];

        const roleOption = document.createElement('option');
        roleOption.value = role.value;
        roleOption.textContent = role.label;
        vendedorSelect.appendChild(roleOption);

        const roleOptionDiv = document.createElement('div');
        roleOptionDiv.classList.add('vendedor-option');
        roleOptionDiv.innerHTML = `
            <input type="checkbox" id="checkbox-${role.value}" />
            <label for="checkbox-${role.value}" class="vendedor-label">${role.label}</label>
        `;
        roleOptionDiv.addEventListener('click', async (event) => {
            const checkbox = document.getElementById(`checkbox-${role.value}`);
            checkbox.checked = !checkbox.checked;
            const roleSelected = checkbox.checked;

            const roleVendedoresList = roleVendedores[role.value];
            roleVendedoresList.forEach(vendedor => {
                const option = Array.from(vendedorSelect.options).find(opt => opt.value === vendedor);
                if (option) {
                    option.selected = roleSelected;
                }
            });

            document.querySelectorAll(`.vendedor-option input[type="checkbox"]`).forEach(cb => {
                if (cb.id === `checkbox-${role.value}`) {
                    cb.checked = roleSelected;
                }
            });
            updateVendedorSelectDisplay();
        });
        vendedorOptionsContainer.appendChild(roleOptionDiv);
    }

    // Adicionar os demais vendedores em ordem alfabética
    const snapshot = await db.collection('users').get();
    const vendedores = snapshot.docs.map(doc => {
        const data = doc.data();
        return { name: data.name, role: data.role, status: data.status };
    }).filter(vendedor => vendedor.name && vendedor.name.trim() !== '' && vendedor.name !== 'undefined' && vendedor.status !== 'inativo').sort((a, b) => a.name.localeCompare(b.name));

    vendedores.forEach(vendedor => {
        if (vendedor.name) { // Verifica se o vendedor não é undefined ou null
            const option = document.createElement('option');
            option.value = vendedor.name;
            option.textContent = vendedor.name;
            vendedorSelect.appendChild(option);

            const optionDiv = document.createElement('div');
            optionDiv.classList.add('vendedor-option');
            optionDiv.innerHTML = `
                <input type="checkbox" id="checkbox-${vendedor.name}" />
                <label for="checkbox-${vendedor.name}" class="vendedor-label">${vendedor.name}</label>
            `;
            optionDiv.addEventListener('click', (event) => {
                const checkbox = document.getElementById(`checkbox-${vendedor.name}`);
                checkbox.checked = !checkbox.checked;
                option.selected = checkbox.checked;
                updateVendedorSelectDisplay();
            });
            vendedorOptionsContainer.appendChild(optionDiv);

            // Adicionar vendedor à lista de vendedores da role correspondente
            if (roleVendedores[vendedor.role]) {
                roleVendedores[vendedor.role].push(vendedor.name);
            }
        }
    });

    // Adicionar evento de clique para exibir/ocultar as opções
    document.getElementById('vendedorSelectDisplay').addEventListener('click', () => {
        const optionsContainer = document.getElementById('vendedorOptions');
        optionsContainer.style.display = optionsContainer.style.display === 'none' ? 'block' : 'none';
    });

    // Adicionar evento de clique ao documento para fechar o filtro ao clicar fora
    document.addEventListener('click', (event) => {
        const optionsContainer = document.getElementById('vendedorOptions');
        const selectDisplay = document.getElementById('vendedorSelectDisplay');
        if (!selectDisplay.contains(event.target) && !optionsContainer.contains(event.target)) {
            optionsContainer.style.display = 'none';
            updateVendedorSelectDisplay();
        }
    });
}

async function fetchCombinedTopClients(vendedores, startDate, endDate) {
    const clientSales = {};

    for (const vendedor of vendedores) {
        const snapshot = await db.collection('relatorioclientes').doc(vendedor).collection('clientes').get();
        snapshot.forEach(doc => {
            const data = doc.data();
            for (const [key, value] of Object.entries(data)) {
                const [year, month] = key.split('-').map(Number);
                const dataDate = new Date(year, month - 1);
                if (dataDate >= startDate && dataDate <= endDate) {
                    if (!clientSales[doc.id]) {
                        clientSales[doc.id] = 0;
                    }
                    clientSales[doc.id] += value;
                }
            }
        });
    }

    const sortedClients = Object.entries(clientSales).sort((a, b) => b[1] - a[1]).slice(0, 5);
    const labels = sortedClients.map(client => client[0]);
    const data = sortedClients.map(client => client[1]);

    const ctx = document.getElementById('relatorioClientesChart').getContext('2d');
    if (chartInstances['relatorioClientesChart']) {
        chartInstances['relatorioClientesChart'].destroy();
    }
    chartInstances['relatorioClientesChart'] = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                label: 'Top 5 Clientes',
                data: data,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Top 5 Clientes por Volume de Vendas' }
            }
        }
    });
}

   
async function updateTotalSalesTarget(vendedores, startDate, endDate) {
    // Adicionar a animação de carregamento
    document.getElementById('totalSalesTarget').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

    let totalMeta = 0;

    // Mapeamento de meses em português para números
    const monthMap = {
        "Janeiro": 1,
        "Fevereiro": 2,
        "Março": 3,
        "Abril": 4,
        "Maio": 5,
        "Junho": 6,
        "Julho": 7,
        "Agosto": 8,
        "Setembro": 9,
        "Outubro": 10,
        "Novembro": 11,
        "Dezembro": 12
    };

    try {
        // Garantir que startDate e endDate sejam objetos Date válidos
        if (startDate) startDate = new Date(startDate);
        if (endDate) {
            endDate = new Date(endDate);
            endDate.setHours(23, 59, 59, 999); // Incluir o dia completo no filtro
        }

        // Criar um mapeamento Nome → E-mail
        const snapshot = await db.collection('users').get();
        const nameToEmailMap = {};
        snapshot.forEach(doc => {
            const userData = doc.data();
            nameToEmailMap[userData.name] = doc.id; // doc.id é o e-mail do usuário
        });

        for (const vendedor of vendedores) {
            const vendedorEmail = nameToEmailMap[vendedor];
            if (!vendedorEmail) {
                console.warn(`E-mail não encontrado para o vendedor: ${vendedor}`);
                continue;
            }

            console.log(`Buscando metas para o vendedor: ${vendedor} (e-mail: ${vendedorEmail})`);
            const metasSnapshot = await db.collection('goals').doc(vendedorEmail).collection('metas').get();

            if (metasSnapshot.empty) {
                console.warn(`Nenhuma meta encontrada para o vendedor: ${vendedor}`);
                continue; // Considera zero para este vendedor
            }

            metasSnapshot.forEach(doc => {
                const metaData = doc.data();
                console.log(`Meta encontrada: ${JSON.stringify(metaData)}`);

                // Verificar se os campos necessários existem
                if (!metaData.monthYear || metaData.value === undefined || metaData.value === null) {
                    console.warn(`Meta inválida encontrada: ${JSON.stringify(metaData)}`);
                    return;
                }

                // Converter o campo monthYear para uma data usando o dia 10
                const [monthName, year] = metaData.monthYear.split('/');
                const month = monthMap[monthName];
                if (!month || !year) {
                    console.warn(`Formato inválido de monthYear: ${metaData.monthYear}`);
                    return;
                }
                const metaDate = new Date(year, month - 1, 10);

                console.log(`MetaDate: ${metaDate}, StartDate: ${startDate}, EndDate: ${endDate}`);

                // Verificar se a meta está dentro do período filtrado
                if (
                    (!startDate || !endDate) || 
                    (metaDate >= startDate && metaDate <= endDate)
                ) {
                    totalMeta += Number(metaData.value) || 0; // Somar o valor da meta
                    console.log(`Meta adicionada: ${metaData.value}, Total até agora: ${totalMeta}`);
                }
            });
        }

        // Atualizar o valor da meta no card
        const formattedTotalMeta = ` ${totalMeta.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
        document.getElementById('totalSalesTarget').textContent = formattedTotalMeta;
        console.log(`Total Meta Final: ${totalMeta}`);
    } catch (error) {
        console.error("Erro ao buscar metas:", error);
    }
}
    
    async function renderCombinedVendasComercialChart(vendedores) {
        const data = {};
        const currentYear = new Date().getFullYear();
        const lastYear = currentYear - 1;
        data[currentYear] = Array(12).fill(0);
        data[lastYear] = Array(12).fill(0);
    
        for (const vendedor of vendedores) {
            const vendasData = await fetchData('relatorios', vendedor);
            if (vendasData) {
                for (const [key, value] of Object.entries(vendasData)) {
                    const [year, month] = key.split('-').map(Number);
                    if (year === currentYear || year === lastYear) {
                        data[year][month - 1] += value;
                    }
                }
            }
        }
    
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const datasets = [
            {
                label: `${lastYear}`,
                data: data[lastYear],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            },
            {
                label: `${currentYear}`,
                data: data[currentYear],
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }
        ];
    
        renderChart(document.getElementById('relatorioComercialChart').getContext('2d'), 'bar', labels, datasets, {
            responsive: true,
            scales: { y: { beginAtZero: true } }
        });
    }
    
    async function renderCombinedVendasCancelamentoChart(vendedores) {
        const data = {};
        const currentYear = new Date().getFullYear();
        const lastYear = currentYear - 1;
        data[currentYear] = Array(12).fill(0);
        data[lastYear] = Array(12).fill(0);
    
        for (const vendedor of vendedores) {
            const vendasData = await fetchData('relatoriocancelados', vendedor);
            if (vendasData) {
                for (const [key, value] of Object.entries(vendasData)) {
                    const [year, month] = key.split('-').map(Number);
                    if (year === currentYear || year === lastYear) {
                        data[year][month - 1] += value;
                    }
                }
            }
        }
    
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const datasets = [
            {
                label: `${lastYear}`,
                data: data[lastYear],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            },
            {
                label: `${currentYear}`,
                data: data[currentYear],
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }
        ];
    
        renderChart(document.getElementById('relatorioCancelamentoChart').getContext('2d'), 'bar', labels, datasets, {
            responsive: true,
            scales: { y: { beginAtZero: true } }
        });
    }
    
    async function renderCombinedADMChart(vendedores, startDate, endDate) {
        const admData = {};
    
        for (const vendedor of vendedores) {
            const snapshot = await db.collection('relatorioadm').doc(vendedor).collection('administradoras').get();
            snapshot.forEach(doc => {
                const data = doc.data();
                for (const [key, value] of Object.entries(data)) {
                    const [year, month] = key.split('-').map(Number);
                    const dataDate = new Date(year, month - 1);
                    if (dataDate >= startDate && dataDate <= endDate) {
                        if (!admData[doc.id]) {
                            admData[doc.id] = 0;
                        }
                        admData[doc.id] += value;
                    }
                }
            });
        }
    
        const sortedADM = Object.entries(admData).sort((a, b) => b[1] - a[1]).slice(0, 5);
        const labels = sortedADM.map(item => item[0]);
        const data = sortedADM.map(item => item[1]);
    
        const ctx = document.getElementById('relatorioADMChart').getContext('2d');
        if (chartInstances['relatorioADMChart']) {
            chartInstances['relatorioADMChart'].destroy();
        }
        chartInstances['relatorioADMChart'] = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true
            }
        });
    }
    
    async function fetchCombinedTopClients(vendedores, startDate, endDate) {
        const clientSales = {};
    
        for (const vendedor of vendedores) {
            const snapshot = await db.collection('relatorioclientes').doc(vendedor).collection('clientes').get();
            snapshot.forEach(doc => {
                const data = doc.data();
                for (const [key, value] of Object.entries(data)) {
                    const [year, month] = key.split('-').map(Number);
                    const dataDate = new Date(year, month - 1);
                    if (dataDate >= startDate && dataDate <= endDate) {
                        if (!clientSales[doc.id]) {
                            clientSales[doc.id] = 0;
                        }
                        clientSales[doc.id] += value;
                    }
                }
            });
        }
    
        const sortedClients = Object.entries(clientSales).sort((a, b) => b[1] - a[1]).slice(0, 5);
        const labels = sortedClients.map(client => client[0]);
        const data = sortedClients.map(client => client[1]);
    
        const ctx = document.getElementById('relatorioClientesChart').getContext('2d');
        if (chartInstances['relatorioClientesChart']) {
            chartInstances['relatorioClientesChart'].destroy();
        }
        chartInstances['relatorioClientesChart'] = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Top 5 Clientes',
                    data: data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'Top 5 Clientes por Volume de Vendas' }
                }
            }
        });
    }
    
    async function fetchCombinedTopProducts(vendedores, startDate, endDate) {
        const productSales = {};
    
        for (const vendedor of vendedores) {
            const snapshot = await db.collection('relatorioprodutos').doc(vendedor).collection('produtos').get();
            snapshot.forEach(doc => {
                const data = doc.data();
                for (const [key, value] of Object.entries(data)) {
                    const [year, month] = key.split('-').map(Number);
                    const dataDate = new Date(year, month - 1);
                    if (dataDate >= startDate && dataDate <= endDate) {
                        if (!productSales[doc.id]) {
                            productSales[doc.id] = 0;
                        }
                        productSales[doc.id] += value;
                    }
                }
            });
        }
    
        const sortedProducts = Object.entries(productSales).sort((a, b) => b[1] - a[1]).slice(0, 5);
        const labels = sortedProducts.map(product => product[0]);
        const data = sortedProducts.map(product => product[1]);
    
        const ctx = document.getElementById('relatorioProdutosChart').getContext('2d');
        if (chartInstances['relatorioProdutosChart']) {
            chartInstances['relatorioProdutosChart'].destroy();
        }
        chartInstances['relatorioProdutosChart'] = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Top 5 Produtos',
                    data: data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'Top 5 Produtos por Volume de Vendas' }
                }
            }
        });
    }
    
    async function fetchCombinedCommissions(vendedores) {
        const data = {};
        const currentYear = new Date().getFullYear();
        const lastYear = currentYear - 1;
        data[currentYear] = Array(12).fill(0);
        data[lastYear] = Array(12).fill(0);
    
        for (const vendedor of vendedores) {
            const comissaoData = await fetchData('relatoriocomissao', vendedor);
            if (comissaoData) {
                for (const [key, value] of Object.entries(comissaoData)) {
                    const [year, month] = key.split('-').map(Number);
                    if (year === currentYear || year === lastYear) {
                        data[year][month - 1] += value;
                    }
                }
            }
        }
    
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Fat', 'Cont' ];
        const datasets = [
            {
                label: `${lastYear}`,
                data: data[lastYear],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            },
            {
                label: `${currentYear}`,
                data: data[currentYear],
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }
        ];
    
        renderComissaoChart(labels, datasets);
    }
    
    function renderComissaoChart(labels, datasets) {
        const ctx = document.getElementById('relatorioComissaoChart').getContext('2d');
    
        // Destroy the existing chart instance if it exists
        if (chartInstances['relatorioComissaoChart']) {
            chartInstances['relatorioComissaoChart'].destroy();
        }
    
        chartInstances['relatorioComissaoChart'] = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    } 

    async function fetchData(collection, vendedor = null) {
        if (!vendedor) {
            return null;
        }

        const docRef = db.collection(collection).doc(vendedor);
        const doc = await docRef.get();
        if (!doc.exists) {
            return null;
        }

        return doc.data();
    }

    async function updateTotalVendas(vendedores, startDate, endDate) {
        let totalVendas = 0;
    
        for (const vendedor of vendedores) {
            const vendasData = await fetchData('relatorios', vendedor);
            if (vendasData) {
                for (const [key, value] of Object.entries(vendasData)) {
                    const [year, month] = key.split('-').map(Number);
                    const vendaDate = new Date(year, month - 1);
    
                    if (vendaDate >= startDate && vendaDate <= endDate) {
                        totalVendas += value;
                    }
                }
            }
        }
    
        document.getElementById('salesCount').textContent = ` ${totalVendas.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
    }

    async function updateTotalCotas(vendedores, startDate, endDate) {
        let totalCotas = 0;
        let totalClientes = new Set();
    
        const vendedoresSet = new Set(vendedores);
    
        const clientesSnapshot = await db.collection('clientes').get();
        for (const clienteDoc of clientesSnapshot.docs) {
            const vendasSnapshot = await clienteDoc.ref.collection('vendas').get();
            for (const vendaDoc of vendasSnapshot.docs) {
                const vendaData = vendaDoc.data();
                const vendaDate = vendaData.dataHoraCadastro.toDate(); // Supondo que dataHoraCadastro é um campo de data
                const vendedor = vendaData.vendedor; // Supondo que vendedor é um campo dentro de vendas
    
                if (vendedoresSet.has(vendedor) && vendaDate >= startDate && vendaDate <= endDate) {
                    totalCotas += 1;
                    totalClientes.add(clienteDoc.id);
                }
            }
        }
    
        document.getElementById('cotasCount').textContent = totalCotas;
        document.getElementById('clientesTotal').textContent = totalClientes.size;
        updateTicketMedio(); // Chama a função para atualizar o ticket médio após cotasCount terminar
    }
        
    function updateTicketMedio() {
            const salesCountText = document.getElementById('salesCount').textContent;
            const cotasCountText = document.getElementById('cotasCount').textContent;

            const salesCount = parseFloat(salesCountText.replace(/[^\d,-]/g, '').replace(',', '.'));
            const cotasCount = parseInt(cotasCountText);

            let ticketMedio = 0;
            if (cotasCount > 0) {
                ticketMedio = salesCount / cotasCount;
            }

            document.getElementById('ticketMedio').textContent = ` ${ticketMedio.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
        }
        
    async function updateTotalComissao(vendedores, startDate, endDate) {
        let totalComissao = 0;
    
        for (const vendedor of vendedores) {
            const clientesSnapshot = await db.collection('clientes').get();
            for (const clienteDoc of clientesSnapshot.docs) {
                const vendasSnapshot = await clienteDoc.ref.collection('vendas').where('vendedor', '==', vendedor).get();
                for (const vendaDoc of vendasSnapshot.docs) {
                    const vendaData = vendaDoc.data();
                    const vendaDate = vendaData.dataHoraCadastro.toDate();
                    if (vendaDate >= startDate && vendaDate <= endDate) {
                        let comissao = 0;
                        switch (vendaData.administradora) {
                            case 'Magalu':
                                if (vendaData.produto === 'NEGOCIADO - IMÓVEL LINEAR A') {
                                    comissao = 0.0075;
                                } else if (vendaData.produto === 'NEGOCIADO - IMÓVEL LINEAR B') {
                                    comissao = 0.0025;
                                } else {
                                    comissao = 0.014;
                                }
                                break;
                            case 'Gazin':
                                comissao = 0.018;
                                break;
                            case 'Servopa':
                                comissao = 0.014;
                                break;
                            case 'Embracon':
                                comissao = 0.017;
                                break;
                            case 'Zema':
                                comissao = 0.018;
                                break;
                            case 'União':
                                if (['IMÓVEIS', 'AUTOMÓVEIS'].includes(vendaData.produto)) {
                                    comissao = 0.015;
                                } else if (['IMÓVEIS MCA', 'AUTOMÓVEIS MCA'].includes(vendaData.produto)) {
                                    comissao = 0.0087;
                                } else if (['CAMINHÕES', 'IMPLEMENTOS'].includes(vendaData.produto)) {
                                    comissao = 0.007;
                                } else if (['MOTOCICLETAS', 'SERVIÇOS'].includes(vendaData.produto)) {
                                    comissao = 0.017;
                                }
                                break;
                            default:
                                comissao = 0;
                        }
                        totalComissao += vendaData.valorCredito * comissao;
                    }
                }
            }
        }
    
        document.getElementById('comissaoTotal').textContent = ` ${totalComissao.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
    }

    auth.onAuthStateChanged(async (user) => {
        if (user) {
            try {
                // Adicionar a animação de carregamento

                const doc = await db.collection('users').doc(user.email).get();
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById('userName').textContent = userData.name;

                    const currentTheme = userData.theme || 'clean';
                    document.body.classList.toggle('dark-mode', currentTheme === 'dark');

                    const currentDate = new Date();
                    const startDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                    const endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);

                    // Verificar papéis permitidos e exibir categorias condicionalmente
                    const gestorComercialLink = document.querySelector('a[href="dashboard_gestor_comercial.html"]');
                    const administrativoLink = document.querySelector('a[href="dashboard_administrativo.html"]');

                    if (['proprietario-socio', 'gestor-comercial', 'gestor-administrativo'].includes(userData.role)) {
                        if (gestorComercialLink) gestorComercialLink.style.display = 'block';
                        if (administrativoLink) administrativoLink.style.display = 'block';
                    } else {
                        if (gestorComercialLink) gestorComercialLink.style.display = 'none';
                        if (administrativoLink) administrativoLink.style.display = 'none';
                    }

                    if (['proprietario-socio', 'gestor-comercial', 'gestor-administrativo'].includes(userData.role)) {
                        document.getElementById('vendedorFilterGroup').style.display = 'block';
                        populateVendedores();
                        const allVendedores = await getAllVendedores();
                        await updateTotalVendas(allVendedores, startDate, endDate);
                        await updateTotalCotas(allVendedores, startDate, endDate);
                        await updateTotalComissao(allVendedores, startDate, endDate);
                    } else {
                        await updateTotalVendas([userData.name], startDate, endDate);
                        await updateTotalCotas([userData.name], startDate, endDate);
                        await updateTotalComissao([userData.name], startDate, endDate);
                    }

                    const currentWeek = new Date().toISOString().slice(0, 10);
                    const currentWeekFormatted = `${currentWeek.substring(0, 4)}-W${String(Math.ceil((new Date(currentWeek).getDate() + 6) / 7)).padStart(2, '0')}`;
                    document.getElementById('semana').value = currentWeekFormatted;
                    carregarTarefasSemana(currentWeekFormatted);
                } else {
                }
            } catch (error) {
            }
        } else {
        }
    });


    async function getAllVendedores() {
        const snapshot = await db.collection('users').get();
        return snapshot.docs.map(doc => doc.data().name);
    }

    function updateLoadingBar(processedDocs, totalDocs) {
        const loadingBar = document.getElementById('loadingBar');
        const progress = (processedDocs / totalDocs) * 100;
        loadingBar.style.width = `${progress}%`;
        loadingBar.textContent = `${Math.round(progress)}%`;
    }

    function mostrarConteudo(conteudoId) {
        document.querySelectorAll('.content').forEach(conteudo => conteudo.classList.remove('active'));
        document.getElementById(conteudoId)?.classList.add('active');
    }
    
    function toggleVisibility() {
        const infoCards = document.querySelectorAll('.info-card p');
        infoCards.forEach(card => {
            if (card.classList.contains('blurred')) {
                card.classList.remove('blurred');
            } else {
                card.classList.add('blurred');
            }
        });
    }
</script>
<script>
    function toggleVisibility(buttonId, sectionId) {
        const section = document.getElementById(sectionId);
        const infoCards = section.querySelectorAll('.info-card p');
        const toggleButton = document.getElementById(buttonId);
        infoCards.forEach(card => {
            if (card.classList.contains('blurred')) {
                card.classList.remove('blurred');
                toggleButton.style.backgroundImage = "url('olhoaberto.png')";
            } else {
                card.classList.add('blurred');
                toggleButton.style.backgroundImage = "url('olhofechado.png')";
            }
        });
    }

function updateVendedorSelectDisplay() {
    const vendedorSelect = document.getElementById('filterVendedor');
    const selectDisplay = document.getElementById('vendedorSelectDisplay');
    const selectedOptions = Array.from(vendedorSelect.selectedOptions).map(option => option.value);

    const roles = {
        'vendedor-interno': 'Vendedores Internos',
        'vendedor-externo': 'Vendedores Externos',
        'indicador': 'Indicadores'
    };

    if (selectedOptions.includes('all')) {
        selectDisplay.textContent = 'Todos os Vendedores';
    } else if (selectedOptions.includes('vendedor-interno')) {
        selectDisplay.textContent = 'Vendedores Internos';
    } else if (selectedOptions.some(option => roles[option])) {
        const selectedRole = selectedOptions.find(option => roles[option]);
        selectDisplay.textContent = roles[selectedRole];
    } else if (selectedOptions.length > 0) {
        selectDisplay.innerHTML = '';
        const container = document.createElement('div');
        container.style.display = 'flex';
        container.style.flexWrap = 'wrap';
        selectedOptions.forEach((optionText, index) => {
            const span = document.createElement('span');
            span.textContent = optionText + (index < selectedOptions.length - 1 ? ', ' : ''); // Adicionar vírgula e espaço entre os nomes
            span.style.cursor = 'pointer';
            span.style.padding = '0'; // Remover qualquer padding
            span.style.whiteSpace = 'nowrap'; // Evitar quebra de linha
            span.addEventListener('click', () => {
                const option = Array.from(vendedorSelect.options).find(opt => opt.value === optionText);
                if (option) {
                    option.selected = false;
                    updateVendedorSelectDisplay();
                }
            });
            container.appendChild(span);
        });
        selectDisplay.appendChild(container);
    } else {
        selectDisplay.textContent = 'Selecione os vendedores';
    }
}

async function populateVendedores() {
    const vendedorSelect = document.getElementById('filterVendedor');
    const vendedorOptionsContainer = document.getElementById('vendedorOptions');
    if (!vendedorSelect || !vendedorOptionsContainer) {
        console.error("Elementos de filtro de vendedor não encontrados no DOM.");
        return;
    }
    vendedorSelect.innerHTML = ''; // Limpa a lista de vendedores antes de preenchê-la
    vendedorOptionsContainer.innerHTML = ''; // Limpa as opções de vendedores antes de preenchê-las

    // Adicionar a opção "Todos os Vendedores"
    const allOption = document.createElement('option');
    allOption.value = 'all';
    allOption.textContent = 'Todos os Vendedores';
    vendedorSelect.appendChild(allOption);

    const allOptionDiv = document.createElement('div');
    allOptionDiv.classList.add('vendedor-option');
    allOptionDiv.innerHTML = `
        <input type="checkbox" id="checkbox-all" />
        <label for="checkbox-all" class="vendedor-label">Todos os Vendedores</label>
    `;
    allOptionDiv.addEventListener('click', (event) => {
        const checkbox = document.getElementById('checkbox-all');
        checkbox.checked = !checkbox.checked;
        const allSelected = checkbox.checked;
        Array.from(vendedorSelect.options).forEach(option => {
            option.selected = allSelected;
        });
        document.querySelectorAll('.vendedor-option input[type="checkbox"]').forEach(cb => {
            cb.checked = allSelected;
        });
        updateVendedorSelectDisplay();
    });
    vendedorOptionsContainer.appendChild(allOptionDiv);

    // Adicionar opções específicas para cada role
    const roles = [
        { value: 'vendedor-interno', label: 'Vendedores Internos' },
        { value: 'vendedor-externo', label: 'Vendedores Externos' },
        { value: 'indicador', label: 'Indicadores' }
    ];

    const roleVendedores = {};

    for (const role of roles) {
        roleVendedores[role.value] = [];

        const roleOption = document.createElement('option');
        roleOption.value = role.value;
        roleOption.textContent = role.label;
        vendedorSelect.appendChild(roleOption);

        const roleOptionDiv = document.createElement('div');
        roleOptionDiv.classList.add('vendedor-option');
        roleOptionDiv.innerHTML = `
            <input type="checkbox" id="checkbox-${role.value}" />
            <label for="checkbox-${role.value}" class="vendedor-label">${role.label}</label>
        `;
        roleOptionDiv.addEventListener('click', async (event) => {
            const checkbox = document.getElementById(`checkbox-${role.value}`);
            checkbox.checked = !checkbox.checked;
            const roleSelected = checkbox.checked;

            const roleVendedoresList = roleVendedores[role.value];
            roleVendedoresList.forEach(vendedor => {
                const option = Array.from(vendedorSelect.options).find(opt => opt.value === vendedor);
                if (option) {
                    option.selected = roleSelected;
                }
            });

            document.querySelectorAll(`.vendedor-option input[type="checkbox"]`).forEach(cb => {
                if (cb.id === `checkbox-${role.value}`) {
                    cb.checked = roleSelected;
                }
            });
            updateVendedorSelectDisplay();
        });
        vendedorOptionsContainer.appendChild(roleOptionDiv);
    }

    // Adicionar os demais vendedores em ordem alfabética
    const snapshot = await db.collection('users').get();
    const vendedores = snapshot.docs.map(doc => {
        const data = doc.data();
        return { name: data.name, role: data.role, status: data.status };
    }).filter(vendedor => vendedor.name && vendedor.name.trim() !== '' && vendedor.name !== 'undefined' && vendedor.status !== 'inativo').sort((a, b) => a.name.localeCompare(b.name));

    vendedores.forEach(vendedor => {
        if (vendedor.name) { // Verifica se o vendedor não é undefined ou null
            const option = document.createElement('option');
            option.value = vendedor.name;
            option.textContent = vendedor.name;
            vendedorSelect.appendChild(option);

            const optionDiv = document.createElement('div');
            optionDiv.classList.add('vendedor-option');
            optionDiv.innerHTML = `
                <input type="checkbox" id="checkbox-${vendedor.name}" />
                <label for="checkbox-${vendedor.name}" class="vendedor-label">${vendedor.name}</label>
            `;
            optionDiv.addEventListener('click', (event) => {
                const checkbox = document.getElementById(`checkbox-${vendedor.name}`);
                checkbox.checked = !checkbox.checked;
                option.selected = checkbox.checked;
                updateVendedorSelectDisplay();
            });
            vendedorOptionsContainer.appendChild(optionDiv);

            // Adicionar vendedor à lista de vendedores da role correspondente
            if (roleVendedores[vendedor.role]) {
                roleVendedores[vendedor.role].push(vendedor.name);
            }
        }
    });

    // Adicionar evento de clique para exibir/ocultar as opções
    document.getElementById('vendedorSelectDisplay').addEventListener('click', () => {
        const optionsContainer = document.getElementById('vendedorOptions');
        optionsContainer.style.display = optionsContainer.style.display === 'none' ? 'block' : 'none';
    });

    // Adicionar evento de clique ao documento para fechar o filtro ao clicar fora
    document.addEventListener('click', (event) => {
        const optionsContainer = document.getElementById('vendedorOptions');
        const selectDisplay = document.getElementById('vendedorSelectDisplay');
        if (!selectDisplay.contains(event.target) && !optionsContainer.contains(event.target)) {
            optionsContainer.style.display = 'none';
            updateVendedorSelectDisplay();
        }
    });
}

function toggleSubmenu(submenuId) {
    const submenu = document.getElementById(submenuId);
    const chevron = submenu.previousElementSibling.querySelector('.fas.fa-chevron-down');

    if (submenu.style.display === 'none' || submenu.style.display === '') {
        submenu.style.display = 'block';
        if (chevron) {
            chevron.style.transform = 'rotate(-90deg)'; // Aponta para a direita
        }
    } else {
        submenu.style.display = 'none';
        if (chevron) {
            chevron.style.transform = 'rotate(0deg)'; // Aponta para baixo
        }
    }
}
    document.getElementById('sidebar').addEventListener('mouseleave', () => {
    const submenu = document.getElementById('homeSubcategoriesSidebar');
    const chevron = document.getElementById('homeChevron');

    if (submenu && submenu.style.display === "block") {
        toggleSubmenu('homeSubcategoriesSidebar'); // Fecha o submenu chamando a função diretamente
    }
});

function toggleSubmenu(submenuId) {
    const submenu = document.getElementById(submenuId);
    const chevron = submenu.previousElementSibling.querySelector('.fas.fa-chevron-down');

    if (submenu.style.display === "none" || submenu.style.display === "") {
        submenu.style.display = "block";
        chevron.style.transform = "rotate(-90deg)"; // Aponta para a direita
    } else {
        submenu.style.display = "none";
        chevron.style.transform = "rotate(0deg)"; // Aponta para baixo
    }
}

function toggleSubmenu(submenuId) {
    const submenu = document.getElementById(submenuId);
    const allSubmenus = document.querySelectorAll('.subcategory-sidebar'); // Seleciona todos os submenus
    const chevron = submenu.previousElementSibling.querySelector('.fas.fa-chevron-down');

    // Fecha outros submenus abertos
    allSubmenus.forEach(otherSubmenu => {
        if (otherSubmenu !== submenu && otherSubmenu.style.display === 'block') {
            otherSubmenu.style.display = 'none';
            const otherChevron = otherSubmenu.previousElementSibling.querySelector('.fas.fa-chevron-down');
            if (otherChevron) {
                otherChevron.style.transform = 'rotate(0deg)'; // Reseta o ícone do submenu fechado
            }
        }
    });

    // Alterna o submenu atual
    if (submenu.style.display === 'none' || submenu.style.display === '') {
        submenu.style.display = 'block';
        if (chevron) {
            chevron.style.transform = 'rotate(-90deg)'; // Aponta para a direita
        }
    } else {
        submenu.style.display = 'none';
        if (chevron) {
            chevron.style.transform = 'rotate(0deg)'; // Aponta para baixo
        }
    }
}

function toggleSubmenu(submenuId) {
    const submenu = document.getElementById(submenuId);
    const homeSubmenu = document.getElementById('homeSubcategoriesSidebar');
    const relatoriosSubmenu = document.getElementById('relatoriosSubcategoriesSidebar');
    const chevron = submenu.previousElementSibling.querySelector('.fas.fa-chevron-down');

    // Fecha o submenu "Home" se o submenu "Relatórios" for clicado
    if (submenuId === 'relatoriosSubcategoriesSidebar' && homeSubmenu.style.display === 'block') {
        homeSubmenu.style.display = 'none';
        const homeChevron = document.getElementById('homeChevron');
        if (homeChevron) {
            homeChevron.style.transform = 'rotate(0deg)'; // Reseta o ícone do submenu fechado
        }
    }

    // Fecha o submenu "Relatórios" se o submenu "Home" for clicado
    if (submenuId === 'homeSubcategoriesSidebar' && relatoriosSubmenu.style.display === 'block') {
        relatoriosSubmenu.style.display = 'none';
        const relatoriosChevron = relatoriosSubmenu.previousElementSibling.querySelector('.fas.fa-chevron-down');
        if (relatoriosChevron) {
            relatoriosChevron.style.transform = 'rotate(0deg)'; // Reseta o ícone do submenu fechado
        }
    }

    // Alterna o submenu atual
    if (submenu.style.display === 'none' || submenu.style.display === '') {
        submenu.style.display = 'block';
        if (chevron) {
            chevron.style.transform = 'rotate(-90deg)'; // Aponta para a direita
        }
    } else {
        submenu.style.display = 'none';
        if (chevron) {
            chevron.style.transform = 'rotate(0deg)'; // Aponta para baixo
        }
    }
}
</script>
<script>
</script>
    </head>
    <body>
        <div class="sidebar" id="sidebar">
            <div class="menu-item">
                    <a href="#" id="homeLink" onclick="toggleSubmenu('homeSubcategoriesSidebar')">
                        <i class="fas fa-home"></i><span>Home</span>
                        <i class="fas fa-chevron-down" id="homeChevron" style="margin-left: 5px; transition: transform 0.3s;"></i>
                    </a>
                    <div id="homeSubcategoriesSidebar" class="subcategory-sidebar">
                        <a href="dashboard.html" class="subcategory"><i class="fas fa-chart-line"></i><span>Dashboard Comercial</span></a>
                        <a href="dashboard_gestor_comercial.html" class="subcategory"><i class="fas fa-chart-bar"></i><span>Dashboard Gestor Comercial</span></a>
                        <a href="dashboard_administrativo.html" class="subcategory"><i class="fas fa-chart-pie"></i><span>Dashboard Administrativo</span></a>
                    </div>
                </div>
            <a href="cadastro_cliente.html"><i class="fas fa-user-plus"></i><span>Cadastrar Cliente</span></a>
            <a href="consultar_cliente.html"><i class="fas fa-search"></i><span>Consultar Cliente</span></a>
            <a href="#" id="relatoriosLink" onclick="toggleSubmenu('relatoriosSubcategoriesSidebar')">
                <i class="fas fa-chart-line"></i><span>Relatórios</span>
                <i class="fas fa-chevron-down" id="homeChevron" style="margin-left: 5px; transition: transform 0.3s;"></i>
            </a>
            <div id="relatoriosSubcategoriesSidebar" class="subcategory-sidebar">
                <a class="subcategory" href="#" onclick="toggleSubmenu('comercialSubcategoriesSidebar'); return false;">
                    <i class="fas fa-briefcase"></i><span>Comercial</span>
                    <i class="fas fa-chevron-down" style="margin-left: 5px; transition: transform 0.3s;"></i>
                </a>
                <div id="comercialSubcategoriesSidebar" class="subcategory-sidebar" style="display: none; padding-left: 20px;">
                    <a href="relatorio_comercial_vendas.html">
                        <i class="fas fa-shopping-cart"></i><span>Vendas</span>
                    </a>
                    <a href="relatorio_comercial_comissao.html" class="subcategory">
                        <i class="fas fa-money-bill-wave"></i><span>Comissão à pagar</span>
                    </a>
                    <a href="relatorio_comercial_comissao_a_receber.html" class="subcategory">
                        <i class="fas fa-hand-holding-usd"></i><span>Comissão à receber</span>
                    </a>
                    <a href="relatorio_comercial_estorno.html" class="subcategory">
                        <i class="fas fa-undo"></i><span>Estorno</span>
                    </a>
                </div>
            </div>
            <a href="gerenciamento_leads.html"><i class="fas fa-users"></i><span>CRM de Leads</span></a>
            <a href="gerenciamento_visitas.html"><i class="fas fa-calendar-check"></i><span>CRM de Visitas</span></a>
            <a href="cadastro_usuario.html"><i class="fas fa-user-cog"></i><span>Cadastrar Usuário</span></a>
            <a href="configuracoes.html"><i class="fas fa-cogs"></i><span>Configurações</span></a>
            <div class="sidebar-bottom-buttons">
                <a href="gerenciar_dados.html" class="sidebar-button"><i class="fas fa-user-cog"></i><span>Perfil</span></a>
                <a href="#" id="sidebarLogoutButton" class="sidebar-button"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
            </div>
        </div>
        <div class="main-content" id="mainContent">
            <div class="header">
                <div class="info-cards">
                    <h1>Dashboard</h1>
                    <div class="info-card centered-content" id="salesTargetCard" style="width: 85%; display: none;">
                    </div>
                    <div class="info-card centered-content" id="clientsServedCard" style="width: 85%; display: none;">
                        <a href="gerenciar_dados.html" class="profile-link">
                            <img src="user-avatar.jpeg" alt="Perfil" style="width: 40px; height: 40px; border-radius: 50%;">
                            <br>
                            <span id="userName">Nome do Usuário</span>
                        </a>
                    </div>
                </div>
            </div>
            <button class="theme-toggle-button" onclick="toggleTheme()">Alternar Tema</button>
            <div class="nav-buttons">
                <button onclick="mostrarConteudo('agenda')">Agenda</button>
                <button onclick="mostrarConteudo('relatorioComercial')">Relatório Resultado</button>    
            </div>
            <div class="content-container">
                <div id="agenda" class="content active">
                    <h2>Agenda</h2>
                    <div class="info-cards">
                        <div class="info-card">
                            <h2>Agenda</h2>
                            <p id="taskCount">0</p>
                        </div>
                        <div class="info-card">
                            <h2>Leads/Semanal</h2>
                            <p id="leadsCount">0</p>
                        </div>
                        <div class="info-card">
                            <h2>Vendas/Mensal</h2>
                            <p id="salesTotal">R$ 0,00</p>
                        </div>
                        <button class="toggle-button" id="toggleButtonAgenda" onclick="toggleVisibility('toggleButtonAgenda', 'agenda')"></button>
                    </div>
                    <div class="week-selector">
                        <label for="semana">Selecione a Semana:</label>
                        <input type="week" id="semana" name="semana" onchange="carregarTarefasSemana(this.value)">
                    </div>
                    <div id="tarefasContainer" class="tasks-container">
                        <!-- Tarefas serão carregadas aqui -->
                    </div>
                </div>
                <div id="relatorioComercial" class="content hidden">
                    <div class="filter-group" id="vendedorFilterGroup" style="display: none;">
                        <label for="filterVendedor">Filtrar Vendedor</label>
                        <div class="select-container">
                            <div id="vendedorSelectDisplay" class="select-display">Selecione os vendedores</div>
                            <div id="vendedorOptions" class="select-options" style="display: none;">
                                <!-- Opções serão preenchidas dinamicamente -->
                            </div>
                        </div>
                        <select id="filterVendedor" multiple style="display: none;">
                            <!-- Opções serão preenchidas dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="filter-group" id="dateFilterGroup">
                        <label for="startDate">Data Início</label>
                        <input type="date" id="startDate" class="date-input">
                        <label for="endDate">Data Fim</label>
                        <input type="date" id="endDate" class="date-input">
                        <button id="applyFilterButton" onclick="applyVendedorFilter()">Aplicar Filtro</button>
                    </div>
                    <div class="info-cards">
                        <div class="info-card">
                            <h2>Metas</h2>
                            <p id="totalSalesTarget"><i class="fas fa-spinner fa-spin"></i></p>
                        </div>
                        <div class="info-card">
                            <h2>Venda</h2>
                            <p id="salesCount"><i class="fas fa-spinner fa-spin"></i></p>
                        </div>
                        <div class="info-card">
                            <h2>Cotas</h2>
                            <p id="cotasCount"><i class="fas fa-spinner fa-spin"></i></p>
                        </div>
                        <div class="info-card">
                            <h2>Ticket Médio</h2>
                            <p id="ticketMedio"><i class="fas fa-spinner fa-spin"></i></p>
                        </div>
                        <div class="info-card">
                            <h2>Clientes</h2>
                            <p id="clientesTotal"><i class="fas fa-spinner fa-spin"></i></p>
                        </div>
                        <div class="info-card">
                            <h2>Comissão</h2>
                            <p id="comissaoTotal"><i class="fas fa-spinner fa-spin"></i></p>
                        </div>
                        <button class="toggle-button" id="toggleButtonRelatorio" onclick="toggleVisibility('toggleButtonRelatorio', 'relatorioComercial')"></button>
                    </div>
                                        <h3>Relatório Resultado</h3>
                    <div class="chart-row" style="display: flex; justify-content: space-between; width: 100%;">
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Vendas Mês/Ano
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Este gráfico mostra as vendas mensais e anuais.</span>
                                </span>
                            </h2>
                            <canvas id="relatorioComercialChart"></canvas>
                        </div>
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Cancelamento Mês/Ano
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Este gráfico mostra os cancelamentos mensais e anuais.</span>
                                </span>
                            </h2>
                            <canvas id="relatorioCancelamentoChart"></canvas>
                        </div>
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Comissão Mês/Ano
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Este gráfico mostra as comissões mensais e anuais.</span>
                                </span>
                            </h2>
                            <canvas id="relatorioComissaoChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-row" style="display: flex; justify-content: space-between; width: 100%; margin-top: 10px;">
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>ADM
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Este gráfico mostra a distribuição das administradoras.</span>
                                </span>
                            </h2>
                            <canvas id="relatorioADMChart"></canvas>
                        </div>
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Clientes
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Este gráfico mostra os principais clientes por volume de vendas.</span>
                                </span>
                            </h2>
                            <canvas id="relatorioClientesChart"></canvas>
                        </div>
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Produtos
                                <span class="tooltip">
                                    <i class="fas fa-info-circle info-icon"></i>
                                    <span class="tooltiptext">Este gráfico mostra os principais produtos por volume de vendas.</span>
                                </span>
                            </h2>
                            <canvas id="relatorioProdutosChart"></canvas>
                        </div>
                    </div>
                </div>
                <div id="relatorioProdutividade" class="content hidden">
                    <h3>Relatório de Produtividade</h3>
                    <div class="info-cards">
                        <div class="info-card">
                            <h2>Total de Tarefas</h2>
                            <p id="taskCount">0</p>
                        </div>
                        <div class="info-card">
                            <h2>Concluidas</h2>
                            <p id="leadsCount">0</p>
                        </div>
                        <div class="info-card">
                            <h2>Pendentes</h2>
                            <p id="leadsCount">0</p>
                        </div>
                        <div class="info-card">
                            <h2>Atrasadas</p>
                            <p id="leadsCount">0</p>
                        </div>
                        <div class="info-card">
                            <h2>Leads Novos</h2>
                            <p id="leadsCount">0</p>
                        </div>
                        <div class="info-card">
                            <h2>Fechado Falta Pagar</h2>
                            <p id="salesTotal">R$ 0,00</p>
                        </div>
                    </div>
                    <div class="chart-row" style="display: flex; justify-content: space-between; width: 100%; margin-top: 10px;">
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Produtividade</h2>
                            <canvas id="relatorioProdutividadeChart"></canvas>
                        </div>
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Tarefas</h2>
                            <canvas id="relatorioTarefasChart"></canvas>
                        </div>
                        <div class="chart-container" style="width: 30%; margin-top: 10px;">
                            <h2>Leads</h2>
                            <canvas id="relatorioLeadsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-row" style="display: flex; justify-content: space-between; width: 100%; margin-top: 10px;">
                        <div class="chart-container" style="width: 45%; margin-top: 10px;">
                            <h2>Quant Vendas Mês/Ano</h2>
                            <canvas id="relatorioVendasChart"></canvas>
                        </div>
                        <div class="chart-container" style="width: 45%; margin-top: 10px;">
                            <h2>Tx Conversão Funil Mês/Ano</h2>
                            <canvas id="relatorioFunilChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </body>
</html>